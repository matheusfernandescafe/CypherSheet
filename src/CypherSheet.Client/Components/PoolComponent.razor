@using CypherSheet.Domain

<MudCard Class="pa-2 ma-2" Elevation="2">
    <MudCardContent>
        <div class="d-flex justify-space-between align-center">
            <MudText Typo="Typo.h6">@Pool.Name</MudText>
            <MudChip T="string" Color="@GetStateColor()" Size="Size.Small">@Pool.Current / @Pool.Max</MudChip>
        </div>
        <MudProgressLinear Color="@GetStateColor()" Value="@ModulateValue(Pool.Current)" Max="@Pool.Max" Class="my-2" />
        <div class="d-flex justify-center gap-4 align-center">
            <MudIconButton Icon="@Icons.Material.Filled.Remove" OnClick="Decrease" Disabled="@(Pool.Current <= 0)" Color="Color.Inherit" />
            <MudText Typo="Typo.h4">@Pool.Current</MudText>
            <MudIconButton Icon="@Icons.Material.Filled.Add" OnClick="Increase" Disabled="@(Pool.Current >= Pool.Max)" Color="Color.Inherit" />
        </div>
        <div class="d-flex justify-center mt-2">
             <MudText Typo="Typo.caption">Edge: @Pool.Edge</MudText>
        </div>
    </MudCardContent>
</MudCard>

@code {
    [Parameter] public Pool Pool { get; set; }
    [Parameter] public EventCallback OnChange { get; set; }

    private double ModulateValue(int val) => (double)val;

    private Color GetStateColor()
    {
        if (Pool.Current == 0) return Color.Error;
        return Color.Primary;
    }

    private async Task Decrease()
    {
        if (Pool.Current > 0)
        {
            Pool.Spend(1);
            await OnChange.InvokeAsync();
        }
    }

    private async Task Increase()
    {
        if (Pool.Current < Pool.Max)
        {
            Pool.Recover(1);
            await OnChange.InvokeAsync();
        }
    }
}
